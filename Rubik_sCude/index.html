<!DOCTTYPE html>
    <html>

    <head>
        <meta charset="utf-8">
        <title></title>
        <style>
            * {
                margin: 0;
                padding: 0;
            }

            body {
                overflow: hidden;
            }

            #wrap {
                width: 100vw;
                height: 100vh;
                display: flex;
                perspective: 1200px;

            }

            #content {
                transform-style: preserve-3d;
                position: relative;
                /* border: 1px solid #ff0000; */
                margin: auto;

            }

            #content>div {
                transform-style: preserve-3d;
                position: absolute;
                top: 0;
                left: 0;
                /* transition: 0.2s; */
                transform-origin: 150px 150px -100px;
            }

            #content>div>p {
                border: 1px solid #000000;
                box-sizing: border-box;
                width: 100%;
                height: 100%;
                position: absolute;
                top: 0;
                left: 0;
            }
        </style>
        <script src="vue.js" type="text/javascript" charset="utf-8"></script>
    </head>

    <body>
        <div id="wrap">
            <div id="content" :style="{
                width: (count*side) + 'px',
                height: (count*side) + 'px',
                <!-- 'transform-origin': (count*side/2)+'px ' + (count*side/2) + 'px - ' + (count*side/2) + 'px', -->
                'transform': 'rotateX(' + contentrotate.x +'deg) rotateY(' + contentrotate.y +'deg)',
                'transition': transition + 's'
            }">

                <div v-for="block in blocks" :x="block.x" :y="block.y" :z="block.z" :style="{
                    width: side+'px',
                    height: side+'px',
                    'transform-origin': side*count/2 + 'px' 
                                      + side*count/2 + 'px -' 
                                      + side*count/3 + 'px',
                    'transform':    'rotateX('+ block.rotate.x + 'deg) '
                                + 'rotateY('+ block.rotate.y + 'deg) ' 

                                + 'rotateZ('+ block.rotate.z + 'deg) '
                                + 'translateX(' + (side*block.x) 
                                + 'px) translateY('  + (side*block.y) 
                                + 'px) translateZ(-' + (side*block.z) + 'px)',
                    'transition': transition + 's'
                }">
                    <p v-for="area in block.areas" :class="area.direct" :style="{
                            transform: area.transform,
                            background: area.color 
                       }" @mousedown="down($event, area)">
                    </p>
                </div>
            </div>
        </div>
        <script>
            new Vue({
                el: '#wrap',
                data() {
                    return {
                        count: 3,
                        side: 100,
                        blocks: [],
                        contentrotate: {
                            x: - 30,
                            y: -30
                        },
                        transition: 0
                    }
                },
                created() {
                    this.getBlocks()
                    // console.log(this.blocks)
                    document.onkeydown = (event) => {
                        if (event.keyCode === 37) {
                            // this.contentrotate.y += 2
                            for (let i = 0; i < this.blocks.length; i++) {
                                this.transition = 0.05
                                this.blocks[i].rotate.y -= 90

                                setTimeout(() => {
                                    this.transition = 0
                                    const oldx = this.blocks[i].x
                                    this.blocks[i].x = this.blocks[i].z
                                    this.blocks[i].z = 2 - oldx
                                    for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                        if (this.blocks[i].areas[j].direct === 'face') { this.blocks[i].areas[j].direct = 'left' }
                                        else if (this.blocks[i].areas[j].direct === 'left') { this.blocks[i].areas[j].direct = 'back' }
                                        else if (this.blocks[i].areas[j].direct === 'right') { this.blocks[i].areas[j].direct = 'face' }
                                        else if (this.blocks[i].areas[j].direct === 'back') { this.blocks[i].areas[j].direct = 'right' }
                                        this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                    }
                                    this.blocks[i].rotate.y += 90
                                }, 50)
                            }

                        }
                        else if (event.keyCode === 39)
                            this.contentrotate.y -= 2
                        else if (event.keyCode === 38)
                            this.contentrotate.x -= 2
                        else if (event.keyCode === 40)
                            this.contentrotate.x += 2

                        //UP
                        else if (event.keyCode === 74) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].y === 0) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.y -= 90

                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldx = this.blocks[i].x
                                        this.blocks[i].x = this.blocks[i].z
                                        this.blocks[i].z = 2 - oldx
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'face') { this.blocks[i].areas[j].direct = 'left' }
                                            else if (this.blocks[i].areas[j].direct === 'left') { this.blocks[i].areas[j].direct = 'back' }
                                            else if (this.blocks[i].areas[j].direct === 'right') { this.blocks[i].areas[j].direct = 'face' }
                                            else if (this.blocks[i].areas[j].direct === 'back') { this.blocks[i].areas[j].direct = 'right' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.y += 90
                                    }, 50)
                                }
                            }
                        }

                        //U'
                        else if (event.keyCode === 70) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].y === 0) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.y += 90

                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldz = this.blocks[i].z
                                        this.blocks[i].z = this.blocks[i].x
                                        this.blocks[i].x = 2 - oldz
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'face') { this.blocks[i].areas[j].direct = 'right' }
                                            else if (this.blocks[i].areas[j].direct === 'left') { this.blocks[i].areas[j].direct = 'face' }
                                            else if (this.blocks[i].areas[j].direct === 'right') { this.blocks[i].areas[j].direct = 'back' }
                                            else if (this.blocks[i].areas[j].direct === 'back') { this.blocks[i].areas[j].direct = 'left' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.y -= 90
                                    }, 50)
                                }
                            }
                        }


                        //Left
                        else if (event.keyCode === 86) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].x === 0) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.x -= 90
                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldz = this.blocks[i].z
                                        this.blocks[i].z = this.blocks[i].y
                                        this.blocks[i].y = 2 - oldz
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'face') { this.blocks[i].areas[j].direct = 'down' }
                                            else if (this.blocks[i].areas[j].direct === 'down') { this.blocks[i].areas[j].direct = 'back' }
                                            else if (this.blocks[i].areas[j].direct === 'up') { this.blocks[i].areas[j].direct = 'face' }
                                            else if (this.blocks[i].areas[j].direct === 'back') { this.blocks[i].areas[j].direct = 'up' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.x += 90
                                    }, 50)
                                }
                            }

                        }
                        //L'
                        else if (event.keyCode === 65) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].x === 0) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.x += 90
                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldy = this.blocks[i].y
                                        this.blocks[i].y = this.blocks[i].z
                                        this.blocks[i].z = 2 - oldy
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'face') { this.blocks[i].areas[j].direct = 'up' }
                                            else if (this.blocks[i].areas[j].direct === 'down') { this.blocks[i].areas[j].direct = 'face' }
                                            else if (this.blocks[i].areas[j].direct === 'up') { this.blocks[i].areas[j].direct = 'back' }
                                            else if (this.blocks[i].areas[j].direct === 'back') { this.blocks[i].areas[j].direct = 'down' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.x -= 90
                                    }, 50)
                                }
                            }

                        }

                        //Rright
                        else if (event.keyCode === 186) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].x === 2) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.x += 90
                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldy = this.blocks[i].y
                                        this.blocks[i].y = this.blocks[i].z
                                        this.blocks[i].z = 2 - oldy
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'back') { this.blocks[i].areas[j].direct = 'down' }
                                            else if (this.blocks[i].areas[j].direct === 'up') { this.blocks[i].areas[j].direct = 'back' }
                                            else if (this.blocks[i].areas[j].direct === 'down') { this.blocks[i].areas[j].direct = 'face' }
                                            else if (this.blocks[i].areas[j].direct === 'face') { this.blocks[i].areas[j].direct = 'up' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.x -= 90
                                    }, 50)
                                }
                            }
                        }

                        //R'
                        else if (event.keyCode === 78) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].x === 2) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.x -= 90
                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldz = this.blocks[i].z
                                        this.blocks[i].z = this.blocks[i].y
                                        this.blocks[i].y = 2 - oldz
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'back') { this.blocks[i].areas[j].direct = 'up' }
                                            else if (this.blocks[i].areas[j].direct === 'up') { this.blocks[i].areas[j].direct = 'face' }
                                            else if (this.blocks[i].areas[j].direct === 'down') { this.blocks[i].areas[j].direct = 'back' }
                                            else if (this.blocks[i].areas[j].direct === 'face') { this.blocks[i].areas[j].direct = 'down' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.x += 90
                                    }, 50)
                                }
                            }
                        }

                        //Face
                        else if (event.keyCode === 85) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].z === 0) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.z += 90
                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldy = this.blocks[i].y
                                        this.blocks[i].y = this.blocks[i].x
                                        this.blocks[i].x = 2 - oldy
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'right') { this.blocks[i].areas[j].direct = 'down' }
                                            else if (this.blocks[i].areas[j].direct === 'up') { this.blocks[i].areas[j].direct = 'right' }
                                            else if (this.blocks[i].areas[j].direct === 'down') { this.blocks[i].areas[j].direct = 'left' }
                                            else if (this.blocks[i].areas[j].direct === 'left') { this.blocks[i].areas[j].direct = 'up' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.z -= 90
                                    }, 50)
                                }
                            }
                        }

                        //F'
                        else if (event.keyCode === 82) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].z === 0) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.z -= 90
                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldx = this.blocks[i].x
                                        this.blocks[i].x = this.blocks[i].y
                                        this.blocks[i].y = 2 - oldx
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'right') { this.blocks[i].areas[j].direct = 'up' }
                                            else if (this.blocks[i].areas[j].direct === 'up') { this.blocks[i].areas[j].direct = 'left' }
                                            else if (this.blocks[i].areas[j].direct === 'down') { this.blocks[i].areas[j].direct = 'right' }
                                            else if (this.blocks[i].areas[j].direct === 'left') { this.blocks[i].areas[j].direct = 'down' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.z += 90
                                    }, 50)
                                }
                            }
                        }


                        //Back
                        else if (event.keyCode === 88) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].z === 2) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.z -= 90
                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldx = this.blocks[i].x
                                        this.blocks[i].x = this.blocks[i].y
                                        this.blocks[i].y = 2 - oldx
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'left') { this.blocks[i].areas[j].direct = 'down' }
                                            else if (this.blocks[i].areas[j].direct === 'down') { this.blocks[i].areas[j].direct = 'right' }
                                            else if (this.blocks[i].areas[j].direct === 'up') { this.blocks[i].areas[j].direct = 'left' }
                                            else if (this.blocks[i].areas[j].direct === 'right') { this.blocks[i].areas[j].direct = 'up' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.z += 90
                                    }, 50)
                                }
                            }
                        }

                        //B'
                        else if (event.keyCode === 190) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].z === 2) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.z -= 90
                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldy = this.blocks[i].y
                                        this.blocks[i].y = this.blocks[i].x
                                        this.blocks[i].x = 2 - oldy
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'right') { this.blocks[i].areas[j].direct = 'down' }
                                            else if (this.blocks[i].areas[j].direct === 'up') { this.blocks[i].areas[j].direct = 'right' }
                                            else if (this.blocks[i].areas[j].direct === 'down') { this.blocks[i].areas[j].direct = 'left' }
                                            else if (this.blocks[i].areas[j].direct === 'left') { this.blocks[i].areas[j].direct = 'up' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.z += 90
                                    }, 50)
                                }
                            }
                        }


                        //Down
                        else if (event.keyCode === 83) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].y === 2) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.y += 90
                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldz = this.blocks[i].z
                                        this.blocks[i].z = this.blocks[i].x
                                        this.blocks[i].x = 2 - oldz
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'back') { this.blocks[i].areas[j].direct = 'left' }
                                            else if (this.blocks[i].areas[j].direct === 'right') { this.blocks[i].areas[j].direct = 'back' }
                                            else if (this.blocks[i].areas[j].direct === 'left') { this.blocks[i].areas[j].direct = 'face' }
                                            else if (this.blocks[i].areas[j].direct === 'face') { this.blocks[i].areas[j].direct = 'right' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.y -= 90
                                    }, 50)
                                }
                            }
                        }

                        //D'
                        else if (event.keyCode === 76) {
                            for (let i = 0; i < this.blocks.length; i++) {
                                if (this.blocks[i].y === 2) {
                                    this.transition = 0.05
                                    this.blocks[i].rotate.y -= 90
                                    setTimeout(() => {
                                        this.transition = 0
                                        const oldx = this.blocks[i].x
                                        this.blocks[i].x = this.blocks[i].z
                                        this.blocks[i].z = 2 - oldx
                                        for (let j = 0; j < this.blocks[i].areas.length; j++) {
                                            if (this.blocks[i].areas[j].direct === 'back') { this.blocks[i].areas[j].direct = 'right' }
                                            else if (this.blocks[i].areas[j].direct === 'right') { this.blocks[i].areas[j].direct = 'face' }
                                            else if (this.blocks[i].areas[j].direct === 'left') { this.blocks[i].areas[j].direct = 'back' }
                                            else if (this.blocks[i].areas[j].direct === 'face') { this.blocks[i].areas[j].direct = 'left' }
                                            this.blocks[i].areas[j].transform = this.getarea(this.blocks[i].areas[j].direct).transform
                                        }
                                        this.blocks[i].rotate.y += 90
                                    }, 50)
                                }
                            }
                        }
                    }
                },
                methods: {
                    getBlocks() {
                        for (let x = 0; x < this.count; x++) {
                            for (let y = 0; y < this.count; y++) {
                                for (let z = 0; z < this.count; z++) {
                                    const block = {
                                        x: x,
                                        y: y,
                                        z: z,
                                        rotate: {
                                            x: 0,
                                            y: 0,
                                            z: 0
                                        },
                                        areas: this.getareas(x, y, z)
                                    }
                                    this.blocks.push(block)
                                }
                            }

                        }
                    },

                    getareas(x, y, z) {
                        const areas = []
                        if (x === 0)
                            areas.push(this.getarea('left'))
                        if (x === this.count - 1)
                            areas.push(this.getarea('right'))
                        if (y === 0)
                            areas.push(this.getarea('up'))
                        if (y === this.count - 1)
                            areas.push(this.getarea('down'))
                        if (z === 0)
                            areas.push(this.getarea('face'))
                        if (z === this.count - 1)
                            areas.push(this.getarea('back'))
                        return areas

                    },

                    getarea(direct) {
                        const transform = {
                            up: 'translateY(-' + this.side / 2 + 'px) rotateX(90deg)',
                            down: 'translateY(' + this.side / 2 + 'px) rotateX(-90deg)',
                            left: 'translateX(-' + this.side / 2 + 'px) rotateY(-90deg)',
                            right: 'translateX(' + this.side / 2 + 'px) rotateY(90deg)',
                            face: 'translateZ(' + this.side / 2 + 'px)',
                            back: 'translateZ(-' + this.side / 2 + 'px)'
                        }

                        const colors = {
                            up: 'yellow',
                            down: 'white',
                            left: 'orange',
                            right: 'red',
                            face: 'blue',
                            back: 'green'
                        }

                        return {
                            direct: direct,
                            transform: transform[direct],
                            color: colors[direct],
                        }
                    },

                    down(event, area) {
                        event.preventDefault()
                        const x = area.x
                        const y = area.y
                        const z = area.z
                        const startx = event.pageX || event.clientX
                        const starty = event.pageY || event.clientY
                        document.onmouseup = (event) => {
                            const endx = event.pageX || event.clientX
                            const endy = event.pageY || event.clientY
                            if (Math.abs(endx - startx) > Math.abs(endy - starty)) {
                                const Clockwise = endx > startx
                                this.RotateY(x, y, z, Clockwise)
                            }
                            else {
                                console.log('y')
                                const Clockwise = endy < starty
                                this.RotateX(x, y, z, Clockwise)
                            }
                            document.onmouseup = null
                        }
                    },

                    RotateY(x, y, z, Clockwise) {
                        if (Clockwise === true) val = 1
                        else val = -1
                        for (let i = 0; i < this.blocks.length; i++) {
                            if (this.blocks[i].y === y) {
                                this.blocks[i].rotate.y += 90 * val
                            }
                        }
                    },

                    RotateX(x, y, z, Clockwise) {
                        if (Clockwise === true) val = 1
                        else val = -1
                        for (let i = 0; i < this.blocks.length; i++) {
                            if (this.blocks[i].x === x) {
                                this.blocks[i].rotate.x += 90 * val
                            }
                        }
                    },
                }

            })
        </script>
    </body>

    </html>
    <!-- vue3 -->